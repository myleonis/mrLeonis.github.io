var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,a=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,r=(e,t)=>{for(var n in t||(t={}))l.call(t,n)&&a(e,n,t[n]);if(o)for(var n of o(t))i.call(t,n)&&a(e,n,t[n]);return e},s=(e,o)=>t(e,n(o)),u=(e,t,n)=>new Promise(((o,l)=>{var i=e=>{try{r(n.next(e))}catch(t){l(t)}},a=e=>{try{r(n.throw(e))}catch(t){l(t)}},r=e=>e.done?o(e.value):Promise.resolve(e.value).then(i,a);r((n=n.apply(e,t)).next())}));import{bk as c,bl as d,X as m,bm as p,d as g,s as f,bn as h,S as v,bo as b,bp as y,bq as C,e as k,i as x,j as w,br as S,h as _,q as O,B as E,x as P,o as L,a0 as D,Z as I,a as R,Y as z,_ as V,bj as N,bs as $,ag as F,b2 as j,aU as A,aG as U,al as T,aL as B,b7 as M,aS as q,bt as K,bu as H,bv as W,bw as G,bx as Q,by as X,c as Y,w as J,v as Z,t as ee,$ as te,bz as ne,N as oe,aw as le,bA as ie,f as ae,aR as re,bB as se,bC as ue,bD as ce,a9 as de,bE as me,r as pe,bF as ge,bG as fe,F as he,p as ve,b as be,bH as ye}from"./vendor.70faab48.js";import{S as Ce}from"./sortable.esm.11f2586f.js";import{u as ke}from"./useDesignSetting.64fe49ff.js";import{_ as xe,i as we,a as Se,b as _e,c as Oe,d as Ee,e as Pe,f as Le}from"./index.2cc56d29.js";import{p as De}from"./propTypes.37756db6.js";import{c as Ie}from"./componentSetting.df76d574.js";import{t as Re,a as ze,u as Ve}from"./index.esm.ce6efd7b.js";const Ne=Symbol("s-table");function $e(){return c(Ne)}function Fe(e){null!==e.parentElement&&e.parentElement.removeChild(e)}function je(e,t,n){const o=0===n?e.children[0]:e.children[n-1].nextSibling;e.insertBefore(t,o)}const Ae="undefined"!=typeof window?window.console:global.console;const Ue=/-(\w)/g,Te=function(e){const t=Object.create(null);return function(n){return t[n]||(t[n]=e(n))}}((e=>e.replace(Ue,((e,t)=>t.toUpperCase())))),Be=["Start","Add","Remove","Update","End"],Me=["Choose","Unchoose","Sort","Filter","Clone"],qe=["Move"],Ke=[qe,Be,Me].flatMap((e=>e)).map((e=>`on${e}`)),He={manage:qe,manageAndEmit:Be,emit:Me};const We=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function Ge(e){return["id","class","role","style"].includes(e)||e.startsWith("data-")||e.startsWith("aria-")}function Qe(e){return e.reduce(((e,[t,n])=>(e[t]=n,e)),{})}function Xe(e){return Object.entries(e).filter((([e,t])=>!Ge(e))).map((([e,t])=>[Te(e),t])).filter((([e,t])=>{return n=e,!(-1!==Ke.indexOf(n));var n}))}const Ye=({el:e})=>e,Je=e=>e.__draggable_context;class Ze{constructor({nodes:{header:e,default:t,footer:n},root:o,realList:l}){this.defaultNodes=t,this.children=[...e,...t,...n],this.externalComponent=o.externalComponent,this.rootTransition=o.transition,this.tag=o.tag,this.realList=l}get _isRootComponent(){return this.externalComponent||this.rootTransition}render(e,t){const{tag:n,children:o,_isRootComponent:l}=this;return e(n,t,l?{default:()=>o}:o)}updated(){const{defaultNodes:e,realList:t}=this;e.forEach(((e,n)=>{var o,l;o=Ye(e),l={element:t[n],index:n},o.__draggable_context=l}))}getUnderlyingVm(e){return Je(e)}getVmIndexFromDomIndex(e,t){const{defaultNodes:n}=this,{length:o}=n,l=t.children,i=l.item(e);if(null===i)return o;const a=Je(i);if(a)return a.index;if(0===o)return 0;const r=Ye(n[0]);return e<[...l].findIndex((e=>e===r))?0:o}}function et(e){const t=["transition-group","TransitionGroup"].includes(e);const n=!function(e){return We.includes(e)}(e)&&!t;return{transition:t,externalComponent:n,tag:n?m(e):t?p:e}}function tt({$slots:e,tag:t,realList:n,getKey:o}){const l=function({$slots:e,realList:t,getKey:n}){const o=t||[],[l,i]=["header","footer"].map((t=>function(e,t){const n=e[t];return n?n():[]}(e,t))),{item:a}=e;if(!a)throw new Error("draggable element must have an item slot");const u=o.flatMap(((e,t)=>a({element:e,index:t}).map((t=>(t.key=n(e),t.props=s(r({},t.props||{}),{"data-draggable":!0}),t)))));if(u.length!==o.length)throw new Error("Item slot must have only one child");return{header:l,footer:i,default:u}}({$slots:e,realList:n,getKey:o}),i=et(t);return new Ze({nodes:l,root:i,realList:n})}function nt(e,t){h((()=>this.$emit(e.toLowerCase(),t)))}function ot(e){return(t,n)=>{if(null!==this.realList)return this[`onDrag${e}`](t,n)}}function lt(e){const t=ot.call(this,e);return(n,o)=>{t.call(this,n,o),nt.call(this,e,n)}}let it=null;const at=g({name:"draggable",inheritAttrs:!1,props:{list:{type:Array,required:!1,default:null},modelValue:{type:Array,required:!1,default:null},itemKey:{type:[String,Function],required:!0},clone:{type:Function,default:e=>e},tag:{type:String,default:"div"},move:{type:Function,default:null},componentData:{type:Object,required:!1,default:null}},emits:["update:modelValue","change",...[...He.manageAndEmit,...He.emit].map((e=>e.toLowerCase()))],data:()=>({error:!1}),render(){try{this.error=!1;const{$slots:e,$attrs:t,tag:n,componentData:o,realList:l,getKey:i}=this,a=tt({$slots:e,tag:n,realList:l,getKey:i});this.componentStructure=a;const s=function({$attrs:e,componentData:t={}}){const n=Qe(Object.entries(e).filter((([e,t])=>Ge(e))));return r(r({},n),t)}({$attrs:t,componentData:o});return a.render(f,s)}catch(e){return this.error=!0,f("pre",{style:{color:"red"}},e.stack)}},created(){null!==this.list&&null!==this.modelValue&&Ae.error("modelValue and list props are mutually exclusive! Please set one or another.")},mounted(){if(this.error)return;const{$attrs:e,$el:t,componentStructure:n}=this;n.updated();const o=function({$attrs:e,callBackBuilder:t}){const n=Qe(Xe(e));Object.entries(t).forEach((([e,t])=>{He[e].forEach((e=>{n[`on${e}`]=t(e)}))}));const o=`[data-draggable]${n.draggable||""}`;return s(r({},n),{draggable:o})}({$attrs:e,callBackBuilder:{manageAndEmit:e=>lt.call(this,e),emit:e=>nt.bind(this,e),manage:e=>ot.call(this,e)}}),l=1===t.nodeType?t:t.parentElement;this._sortable=new Ce(l,o),this.targetDomElement=l,l.__draggable_component__=this},updated(){this.componentStructure.updated()},beforeUnmount(){void 0!==this._sortable&&this._sortable.destroy()},computed:{realList(){const{list:e}=this;return e||this.modelValue},getKey(){const{itemKey:e}=this;return"function"==typeof e?e:t=>t[e]}},watch:{$attrs:{handler(e){const{_sortable:t}=this;t&&Xe(e).forEach((([e,n])=>{t.option(e,n)}))},deep:!0}},methods:{getUnderlyingVm(e){return this.componentStructure.getUnderlyingVm(e)||null},getUnderlyingPotencialDraggableComponent:e=>e.__draggable_component__,emitChanges(e){h((()=>this.$emit("change",e)))},alterList(e){if(this.list)return void e(this.list);const t=[...this.modelValue];e(t),this.$emit("update:modelValue",t)},spliceList(){this.alterList((e=>e.splice(...arguments)))},updatePosition(e,t){this.alterList((n=>n.splice(t,0,n.splice(e,1)[0])))},getRelatedContextFromMoveEvent({to:e,related:t}){const n=this.getUnderlyingPotencialDraggableComponent(e);if(!n)return{component:n};const o=n.realList,l={list:o,component:n};if(e!==t&&o){const e=n.getUnderlyingVm(t)||{};return r(r({},e),l)}return l},getVmIndexFromDomIndex(e){return this.componentStructure.getVmIndexFromDomIndex(e,this.targetDomElement)},onDragStart(e){this.context=this.getUnderlyingVm(e.item),e.item._underlying_vm_=this.clone(this.context.element),it=e.item},onDragAdd(e){const t=e.item._underlying_vm_;if(void 0===t)return;Fe(e.item);const n=this.getVmIndexFromDomIndex(e.newIndex);this.spliceList(n,0,t);const o={element:t,newIndex:n};this.emitChanges({added:o})},onDragRemove(e){if(je(this.$el,e.item,e.oldIndex),"clone"===e.pullMode)return void Fe(e.clone);const{index:t,element:n}=this.context;this.spliceList(t,1);const o={element:n,oldIndex:t};this.emitChanges({removed:o})},onDragUpdate(e){Fe(e.item),je(e.from,e.item,e.oldIndex);const t=this.context.index,n=this.getVmIndexFromDomIndex(e.newIndex);this.updatePosition(t,n);const o={element:this.context.element,oldIndex:t,newIndex:n};this.emitChanges({moved:o})},computeFutureIndex(e,t){if(!e.element)return 0;const n=[...t.to.children].filter((e=>"none"!==e.style.display)),o=n.indexOf(t.related),l=e.component.getVmIndexFromDomIndex(o);return-1!==n.indexOf(it)||!t.willInsertAfter?l:l+1},onDragMove(e,t){const{move:n,realList:o}=this;if(!n||!o)return!0;const l=this.getRelatedContextFromMoveEvent(e),i=this.computeFutureIndex(l,e),a=s(r({},this.context),{futureIndex:i});return n(s(r({},e),{relatedContext:l,draggedContext:a}),t)},onDragEnd(){it=null}}});const rt=g({name:"ColumnSetting",components:{SettingOutlined:v,DragOutlined:b,Draggable:at,VerticalRightOutlined:y,VerticalLeftOutlined:C},setup(){const{getDarkTheme:e}=ke(),t=$e(),n=k([]),o=k([]),l=x({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),i=w((()=>l.selection));function a(e){t.setColumns(e)}function u(){let e=[];return t.getColumns().forEach((t=>{e.push(r({},t))})),e}return S((()=>{t.getColumns().length&&function(){const e=u(),t=e.map((e=>e.key));l.checkList=t,l.defaultCheckList=t;const i=e.filter((e=>"action"!=e.key&&"操作"!=e.title));n.value.length||(n.value=O(i),o.value=O(i))}()})),s(r({},_(l)),{columnsList:n,getDarkTheme:e,onChange:function(e){l.selection&&e.unshift("selection"),a(e)},onCheckAll:function(e){let n=t.getCacheColumns(!0);e?(a(n),l.checkList=n):(a([]),l.checkList=[])},onSelection:function(e){let n=t.getCacheColumns();e?(n.unshift({type:"selection",key:"selection"}),a(n)):(n.splice(0,1),a(n))},resetColumns:function(){l.checkList=[...l.defaultCheckList],l.checkAll=!0;let e=t.getCacheColumns().map((e=>s(r({},e),{fixed:void 0})));a(e),n.value=e},fixedColumn:function(e,o){if(!l.checkList.includes(e.key))return;let i=u();const r=e.fixed===o?void 0:o;let s=i.findIndex((t=>t.key===e.key));-1!==s&&(i[s].fixed=r),t.setCacheColumnsField(e.key,{fixed:r}),n.value[s].fixed=r,a(i)},draggableEnd:function(){const e=E(P(n));n.value=e,a(e)},getSelection:i})}}),st={class:"cursor-pointer table-toolbar-right-icon"},ut={class:"table-toolbar-inner-popover-title"},ct=N("列展示"),dt=N("勾选列"),mt=N("重置"),pt={class:"table-toolbar-inner"},gt={class:"drag-icon"},ft={class:"fixed-item"},ht=R("span",null,"固定到左侧",-1),vt=R("span",null,"固定到右侧",-1),bt=R("span",null,"列设置",-1);var yt,Ct,kt=xe(rt,[["render",function(e,t,n,o,l,i){const a=m("SettingOutlined"),r=m("n-icon"),s=m("n-checkbox"),u=m("n-button"),c=m("n-space"),d=m("DragOutlined"),p=m("VerticalRightOutlined"),g=m("n-tooltip"),f=m("n-divider"),h=m("VerticalLeftOutlined"),v=m("Draggable"),b=m("n-checkbox-group"),y=m("n-popover");return L(),D(g,{trigger:"hover"},{trigger:I((()=>[R("div",st,[z(y,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:I((()=>[z(r,{size:"18"},{default:I((()=>[z(a)])),_:1})])),header:I((()=>[R("div",ut,[z(c,null,{default:I((()=>[z(s,{checked:e.checkAll,"onUpdate:checked":[t[0]||(t[0]=t=>e.checkAll=t),e.onCheckAll]},{default:I((()=>[ct])),_:1},8,["checked","onUpdate:checked"]),z(s,{checked:e.selection,"onUpdate:checked":[t[1]||(t[1]=t=>e.selection=t),e.onSelection]},{default:I((()=>[dt])),_:1},8,["checked","onUpdate:checked"]),z(u,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:I((()=>[mt])),_:1},8,["onClick"])])),_:1})])])),default:I((()=>[R("div",pt,[z(b,{value:e.checkList,"onUpdate:value":[t[3]||(t[3]=t=>e.checkList=t),e.onChange]},{default:I((()=>[z(v,{modelValue:e.columnsList,"onUpdate:modelValue":t[2]||(t[2]=t=>e.columnsList=t),animation:"300","item-key":"key",onEnd:e.draggableEnd},{item:I((({element:t})=>[R("div",{class:V(["table-toolbar-inner-checkbox",{"table-toolbar-inner-checkbox-dark":!0===e.getDarkTheme}])},[R("span",gt,[z(r,{size:"18"},{default:I((()=>[z(d)])),_:1})]),z(s,{value:t.key,label:t.title},null,8,["value","label"]),R("div",ft,[z(g,{trigger:"hover",placement:"bottom"},{trigger:I((()=>[z(r,{size:"18",color:"left"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"left")},{default:I((()=>[z(p)])),_:2},1032,["color","onClick"])])),default:I((()=>[ht])),_:2},1024),z(f,{vertical:""}),z(g,{trigger:"hover",placement:"bottom"},{trigger:I((()=>[z(r,{size:"18",color:"right"===t.fixed?"#2080f0":void 0,class:"cursor-pointer",onClick:n=>e.fixedColumn(t,"right")},{default:I((()=>[z(h)])),_:2},1032,["color","onClick"])])),default:I((()=>[vt])),_:2},1024)])],2)])),_:1},8,["modelValue","onEnd"])])),_:1},8,["value","onUpdate:value"])])])),_:1})])])),default:I((()=>[bt])),_:1})}]]);(Ct=yt||(yt={})).NInput="on-input",Ct.NInputNumber="on-input",Ct.NSelect="on-update:value",Ct.NSwitch="on-update:value",Ct.NCheckbox="on-update:value",Ct.NDatePicker="on-update:value",Ct.NTimePicker="on-update:value";const xt=new Map;xt.set("NInput",F),xt.set("NInputNumber",j),xt.set("NSelect",A),xt.set("NSwitch",U),xt.set("NCheckbox",T),xt.set("NDatePicker",B),xt.set("NTimePicker",M);function wt(e,t,n){e&&t&&n&&e.addEventListener(t,n,!1)}const St=new Map;let _t;function Ot(e,t){let n=[];return Array.isArray(t.arg)?n=t.arg:n.push(t.arg),function(o,l){const i=t.instance.popperRef,a=o.target,r=l.target,s=!t||!t.instance,u=!a||!r,c=e.contains(a)||e.contains(r),d=e===a,m=n.length&&n.some((e=>null==e?void 0:e.contains(a)))||n.length&&n.includes(r),p=i&&(i.contains(a)||i.contains(r));s||u||c||d||m||p||t.value()}}we||(wt(document,"mousedown",(e=>_t=e)),wt(document,"mouseup",(e=>{for(const{documentHandler:t}of St.values())t(e,_t)})));function Et(e){return"NInput"===e?"请输入":["NPicker","NSelect","NCheckbox","NRadio","NSwitch","NDatePicker","NTimePicker"].includes(e)?"请选择":""}function Pt(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function Lt(e){var t=e.years,n=e.months,o=e.weeks,l=e.days,i=e.hours,a=e.minutes,r=e.seconds;Pt(1,arguments);var s=0;t&&(s+=365.2425*t),n&&(s+=30.436875*n),o&&(s+=7*o),l&&(s+=l);var u=24*s*60*60;return i&&(u+=60*i*60),a&&(u+=60*a),r&&(u+=r),Math.round(1e3*u)}const Dt=g({name:"EditableCell",components:{FormOutlined:K,CloseOutlined:H,CheckOutlined:W,CellComponent:({component:e="NInput",rule:t=!0,ruleMessage:n,popoverVisible:o},{attrs:l})=>{const i=xt.get(e),a=f(i,l);return t?f(q,{"display-directive":"show",show:!!o,manual:"manual"},{trigger:()=>a,default:()=>f("span",{style:{color:"red",width:"90px",display:"inline-block"}},{default:()=>n})}):a}},directives:{clickOutside:{beforeMount(e,t){St.set(e,{documentHandler:Ot(e,t),bindingFn:t.value})},updated(e,t){St.set(e,{documentHandler:Ot(e,t),bindingFn:t.value})},unmounted(e){St.delete(e)}}},props:{value:{type:[String,Number,Boolean,Object],default:""},record:{type:Object},column:{type:Object,default:()=>({})},index:De.number},setup(e){const t=$e(),n=k(!1),o=k(),l=k(!1),i=k(""),a=k([]),c=k(e.value),d=k(e.value),m=w((()=>{var t;return(null==(t=e.column)?void 0:t.editComponent)||"NInput"})),p=w((()=>{var t;return null==(t=e.column)?void 0:t.editRule})),g=w((()=>P(i)&&P(l))),f=w((()=>{const e=P(m);return["NCheckbox","NSwitch"].includes(e)})),v=w((()=>{var t,n,o,l;const i=null!=(n=null==(t=e.column)?void 0:t.editComponentProps)?n:{},a=null!=(l=null==(o=e.column)?void 0:o.editComponent)?l:null,u=P(m),d=P(f),p=d?"checked":"value",g=P(c);let h=d?Se(g)&&_e(g)?g:!!g:g;Oe(h)&&"NDatePicker"===u?h=Lt(h):Ee(h)&&"NDatePicker"===u&&(h=h.map((e=>Lt(e))));const v=a?yt[a]:void 0;return s(r(r({placeholder:Et(P(m))},{}),G(i,"onChange")),{[v]:_,[p]:h})})),b=w((()=>{var t,n;const{editComponentProps:o,editValueMap:l}=e.column,i=P(c);if(l&&Pe(l))return l(i);if(!P(m).includes("NSelect"))return i;const r=(null!=(t=null==o?void 0:o.options)?t:P(a)||[]).find((e=>`${e.value}`==`${i}`));return null!=(n=null==r?void 0:r.label)?n:i})),y=w((()=>({width:"calc(100% - 48px)"}))),C=w((()=>{const{align:t="center"}=e.column;return`edit-cell-align-${t}`})),x=w((()=>{const{editable:t}=e.record||{};return!!t}));function _(n){return u(this,arguments,(function*(n){var o,l,i;const a=P(m);n?(null==n?void 0:n.target)&&Reflect.has(n.target,"value")?c.value=n.target.value:"NCheckbox"===a?c.value=n.target.checked:(Oe(n)||_e(n)||Se(n))&&(c.value=n):c.value=n;const r=null==(l=null==(o=e.column)?void 0:o.editComponentProps)?void 0:l.onChange;r&&Pe(r)&&r(...arguments),null==(i=t.emit)||i.call(t,"edit-change",{column:e.column,value:P(c),record:E(e.record)}),yield O()}))}function O(){return u(this,null,(function*(){const{column:t,record:n}=e,{editRule:o}=t,a=P(c);if(o){if(_e(o)&&!a&&!Se(a)){l.value=!0;const e=P(m);return i.value=Et(e),!1}if(Pe(o)){const e=yield o(a,n);return e?(i.value=e,l.value=!0,!1):(i.value="",!0)}}return i.value="",!0}))}function L(o=!0,l=!0){return u(this,null,(function*(){var i;if(l){if(!(yield O()))return!1}const{column:a,index:r,record:s}=e;if(!s)return!1;const{key:u}=a,d=P(c);if(!u)return;Q(s,u,d),o&&(null==(i=t.emit)||i.call(t,"edit-end",{record:s,index:r,key:u,value:d})),n.value=!1}))}function D(){var o;n.value=!1,c.value=d.value;const{column:a,index:r,record:s}=e,{key:u}=a;l.value=!0,i.value="",null==(o=t.emit)||o.call(t,"edit-cancel",{record:s,index:r,key:u,value:P(c)})}function I(t,n){var o;e.record&&(Ee(e.record[t])?null==(o=e.record[t])||o.push(n):e.record[t]=[n])}return S((()=>{d.value=e.value})),S((()=>{const{editable:t}=e.column;(_e(t)||_e(P(x)))&&(n.value=!!t||P(x))})),e.record&&(I("submitCbs",L),I("validCbs",O),I("cancelCbs",D),e.column.key&&(e.record.editValueRefs||(e.record.editValueRefs={}),e.record.editValueRefs[e.column.key]=c),e.record.onCancelEdit=()=>{var t,n;Ee(null==(t=e.record)?void 0:t.cancelCbs)&&(null==(n=e.record)||n.cancelCbs.forEach((e=>e())))},e.record.onSubmitEdit=()=>u(this,null,(function*(){var n,o,l,i;if(Ee(null==(n=e.record)?void 0:n.submitCbs)){const n=((null==(o=e.record)?void 0:o.validCbs)||[]).map((e=>e()));if(!(yield Promise.all(n)).every((e=>!!e)))return;return((null==(l=e.record)?void 0:l.submitCbs)||[]).forEach((e=>e(!1,!1))),null==(i=t.emit)||i.call(t,"edit-row-end"),!0}}))),{isEdit:n,handleEdit:function(){var t;P(x)||P(null==(t=e.column)?void 0:t.editRow)||(i.value="",n.value=!0,h((()=>{var e;const t=P(o);null==(e=null==t?void 0:t.focus)||e.call(t)})))},currentValueRef:c,handleSubmit:L,handleChange:_,handleCancel:D,elRef:o,getComponent:m,getRule:p,onClickOutside:function(){var t;if((null==(t=e.column)?void 0:t.editable)||P(x))return;P(m).includes("NInput")&&D()},ruleMessage:i,getRuleVisible:g,getComponentProps:v,handleOptionsChange:function(e){a.value=e},getWrapperStyle:y,getWrapperClass:C,getRowEditable:x,getValues:b,handleEnter:function(){return u(this,null,(function*(){var t;(null==(t=e.column)?void 0:t.editRow)||(yield L())}))}}}}),It={class:"editable-cell"},Rt={class:"flex editable-cell-content"},zt={class:"editable-cell-content-comp"},Vt={key:0,class:"editable-cell-action"};var Nt=xe(Dt,[["render",function(e,t,n,o,l,i){const a=m("FormOutlined"),r=m("n-icon"),s=m("CellComponent"),u=m("CheckOutlined"),c=m("CloseOutlined"),d=X("click-outside");return L(),Y("div",It,[J(R("div",{class:"editable-cell-content",onClick:t[0]||(t[0]=(...t)=>e.handleEdit&&e.handleEdit(...t))},[N(ee(e.getValues)+" ",1),e.column.editRow?te("",!0):(L(),D(r,{key:0,class:"edit-icon"},{default:I((()=>[z(a)])),_:1}))],512),[[Z,!e.isEdit]]),J(R("div",Rt,[R("div",zt,[z(s,ne(e.getComponentProps,{component:e.getComponent,style:e.getWrapperStyle,popoverVisible:e.getRuleVisible,ruleMessage:e.ruleMessage,rule:e.getRule,class:e.getWrapperClass,ref:"elRef",onOptionsChange:e.handleOptionsChange,onPressEnter:e.handleEnter}),null,16,["component","style","popoverVisible","ruleMessage","rule","class","onOptionsChange","onPressEnter"])]),e.getRowEditable?te("",!0):(L(),Y("div",Vt,[z(r,{class:"mx-2 cursor-pointer"},{default:I((()=>[z(u,{onClick:e.handleSubmit},null,8,["onClick"])])),_:1}),z(r,{class:"mx-2 cursor-pointer"},{default:I((()=>[z(c,{onClick:e.handleCancel},null,8,["onClick"])])),_:1})]))],512),[[Z,e.isEdit],[d,e.onClickOutside]])])}]]);function $t(e){const t=k(P(e).columns);let n=P(e).columns;const o=w((()=>{const n=O(P(t));return function(e,t){const{actionColumn:n}=P(e);if(!n)return;!t.find((e=>"action"===e.key))&&t.push(r({},n))}(e,n),n||[]})),{hasPermission:l}=Le();const i=w((()=>{const e=P(o);return O(e).filter((e=>l(e.auth)&&function(e){const t=e.ifShow;let n=!0;return _e(t)&&(n=t),Pe(t)&&(n=t(e)),n}(e))).map((e=>{e.ellipsis=void 0===e.ellipsis&&{tooltip:!0};const{edit:t}=e;if(t&&(e.render=function(e){return(t,n)=>{const o=e.key,l=t[o];return t.onEdit=(e,n=!1)=>u(this,null,(function*(){var o,l;return n||(t.editable=e),!e&&n?!!(yield null==(o=t.onSubmitEdit)?void 0:o.call(t))&&(t.editable=!1,!0):(e||n||null==(l=t.onCancelEdit)||l.call(t),!0)})),f(Nt,{value:l,record:t,column:e,index:n})}}(e),t)){const t=e.title;e.title=()=>{return e=f("span",{},[f("span",{style:{"margin-right":"5px"}},t),f(oe,{size:14},{default:()=>f(K)})]),n="该列可编辑",f(le,null,{trigger:()=>e,default:()=>n});var e,n}}return e}))}));return $((()=>P(e).columns),(e=>{t.value=e,n=e})),{getColumnsRef:o,getCacheColumns:function(e){return e?n.map((e=>e.key)):n},setCacheColumnsField:function(e,t){e&&t&&n.forEach((n=>{n.key!==e||Object.assign(n,t)}))},setColumns:function(e){const o=O(e);if(!Ee(o))return;if(!o.length)return void(t.value=[]);const l=n.map((e=>e.key));if(Oe(o[0])){const i=[];n.forEach((t=>{e.includes(t.key)&&i.push(r({},t))})),ie(l,o)||i.sort(((e,t)=>l.indexOf(e.key)-l.indexOf(t.key))),t.value=i}else t.value=o},getColumns:function(){return E(P(o)).map((e=>s(r({},e),{title:e.title,key:e.key,fixed:e.fixed||void 0})))},getPageColumns:i}}const{table:Ft}=Ie,{apiSetting:jt,defaultPageSize:At,pageSizes:Ut}=Ft,Tt=At,Bt=jt,Mt=Ut;const qt=s(r({},re.props),{title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},tableData:{type:[Object],default:()=>[]},columns:{type:[Array],default:()=>[],required:!0},request:{type:Function,default:null,required:!0},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},showPagination:{type:[String,Boolean],default:"auto"},actionColumn:{type:Object,default:null},canResize:De.bool.def(!0),resizeHeightOffset:De.number.def(0)});const Kt=[{type:"menu",label:"紧凑",key:"small"},{type:"menu",label:"默认",key:"medium"},{type:"menu",label:"宽松",key:"large"}],Ht=g({components:{ReloadOutlined:se,ColumnHeightOutlined:ue,ColumnSetting:kt,QuestionCircleOutlined:ce},props:r({},qt),emits:["fetch-success","fetch-error","update:checked-row-keys","edit-end","edit-cancel","edit-row-end","edit-change"],setup(e,{emit:t}){const n=k(150),o=k(null),l=k(null);let i;const a=k([]),c=k(),m=w((()=>r(r({},e),P(c)))),{getLoading:p,setLoading:g}=function(e){const t=k(P(e).loading);return $((()=>P(e).loading),(e=>{t.value=e})),{getLoading:w((()=>P(t))),setLoading:function(e){t.value=e}}}(m),{getPaginationInfo:f,setPagination:v}=function(e){const t=k({}),n=k(!0),o=w((()=>{const{pagination:o}=P(e);if(!P(n)||_e(o)&&!o)return!1;const{totalField:l}=Bt;return s(r(r({pageSize:Tt,pageSizes:Mt,showSizePicker:!0,showQuickJumper:!0},_e(o)?{}:o),P(t)),{pageCount:P(t)[l]})}));return{getPagination:function(){return P(o)},getPaginationInfo:o,setShowPagination:function(e){return u(this,null,(function*(){n.value=e}))},getShowPagination:function(){return P(n)},setPagination:function(e){const n=P(o);t.value=r(r({},_e(n)?{}:n),e)}}}(m),{getDataSourceRef:b,getRowKey:y,reload:C}=function(e,{getPaginationInfo:t,setPagination:n,setLoading:o,tableData:l},i){const a=k([]);S((()=>{l.value=P(a)})),$((()=>P(e).dataSource),(()=>{const{dataSource:t}=P(e);t&&(a.value=t)}),{immediate:!0});const s=w((()=>{const{rowKey:t}=P(e);return t||(()=>"key")})),c=w((()=>{const e=P(a);return e&&e.length,P(a)}));function d(l){return u(this,null,(function*(){try{o(!0);const{request:s,pagination:u}=P(e),c=Bt.pageField,m=Bt.sizeField,p=Bt.totalField,g=Bt.listField;let f={};const{page:h=1,pageSize:v=10}=P(t);_e(u)&&!u||_e(t)?f={}:(f[c]=l&&l[c]||h,f[m]=v);const b=r({},f),y=yield s(b),C=y[p]||0,k=y[c];C&&h>C&&(n({[c]:C}),d(l));const x=y[g]?y[g]:[];a.value=x,n({[c]:k,[p]:C}),l&&l[c]&&n({[c]:l[c]||1}),i("fetch-success",{items:P(x),resultTotal:C})}catch(s){i("fetch-error",s),a.value=[]}finally{o(!1)}}))}return ae((()=>{setTimeout((()=>{d()}),16)})),{fetch:d,getRowKey:s,getDataSourceRef:c,getDataSource:function(){return c.value},setTableData:function(e){a.value=e},reload:function(e){return u(this,null,(function*(){yield d(e)}))}}}(m,{getPaginationInfo:f,setPagination:v,tableData:a,setLoading:g},t),{getPageColumns:O,setColumns:L,getColumns:D,getCacheColumns:I,setCacheColumnsField:R}=$t(m),z=x({tableSize:P(m).size||"medium",isColumnSetting:!1});const V=w((()=>z.tableSize)),N=w((()=>{const e=P(b),t=e.length?`${P(n)}px`:"auto";return s(r({},P(m)),{loading:P(p),columns:E(P(O)),rowKey:P(y),data:e,size:P(V),remote:!0,"max-height":t})})),F=w((()=>E(P(f))));const j={reload:C,setColumns:L,setLoading:g,setProps:function(e){c.value=r(r({},P(c)),e)},getColumns:D,getPageColumns:O,getCacheColumns:I,setCacheColumnsField:R,emit:t},A=w((()=>{const{canResize:e}=P(m);return e}));function U(){return u(this,null,(function*(){const t=P(o);if(!t)return;if(!P(A))return;const l=null==t?void 0:t.$el,a=l.querySelector(".n-data-table-thead "),{bottomIncludeBody:r}=function(e){const t=document.documentElement,n=t.scrollLeft,o=t.scrollTop,l=t.clientLeft,i=t.clientTop,a=window.pageXOffset,r=window.pageYOffset,s=function(e){return e&&e.getBoundingClientRect?e.getBoundingClientRect():0}(e),{left:u,top:c,width:d,height:m}=s,p=u+a-((a||n)-(l||0)),g=c+r-((r||o)-(i||0)),f=window.document.documentElement.clientWidth,h=window.document.documentElement.clientHeight;return{left:p,top:g,right:f-d-p,bottom:h-m-g,rightIncludeBody:f-p,bottomIncludeBody:h-g}}(a);let s=2;if(!_e(F))if(i=l.querySelector(".n-data-table__pagination"),i){s+=i.offsetHeight||0}else s+=28;let u=r-(64+s+24+(e.resizeHeightOffset||0));const c=e.maxHeight;u=c&&c<u?c:u,n.value=u}))}var T;return function(e,t=150,n){let o=()=>{e()};const l=Ve(o,t);o=l;const i=()=>{n&&n.immediate&&o(),window.addEventListener("resize",o)},a=()=>{window.removeEventListener("resize",o)};Re((()=>{i()})),ze((()=>{a()}))}(U,280),ae((()=>{h((()=>{U()}))})),T=s(r({},j),{wrapRef:l,getBindValues:N}),d(Ne,T),s(r({},_(z)),{tableElRef:o,getBindValues:N,densityOptions:Kt,reload:C,densitySelect:function(e){z.tableSize=e},updatePage:function(e){v({page:e}),C()},updatePageSize:function(e){v({page:1,pageSize:e}),C()},pagination:F,tableAction:j})}}),Wt=e=>(ve("data-v-1b1df032"),e=e(),be(),e),Gt={class:"table-toolbar"},Qt={class:"flex items-center table-toolbar-left"},Xt={key:0,class:"table-toolbar-left-title"},Yt={class:"flex items-center table-toolbar-right"},Jt=Wt((()=>R("span",null,"刷新",-1))),Zt={class:"table-toolbar-right-icon"},en=Wt((()=>R("span",null,"密度",-1))),tn={class:"s-table"};var nn=xe(Ht,[["render",function(e,t,n,o,l,i){const a=m("QuestionCircleOutlined"),r=m("n-icon"),s=m("n-tooltip"),u=m("ReloadOutlined"),c=m("ColumnHeightOutlined"),d=m("n-dropdown"),p=m("ColumnSetting"),g=m("n-data-table");return L(),Y(he,null,[R("div",Gt,[R("div",Qt,[e.title?(L(),Y("div",Xt,[N(ee(e.title)+" ",1),e.titleTooltip?(L(),D(s,{key:0,trigger:"hover"},{trigger:I((()=>[z(r,{size:"18",class:"ml-1 cursor-pointer text-gray-400"},{default:I((()=>[z(a)])),_:1})])),default:I((()=>[N(" "+ee(e.titleTooltip),1)])),_:1})):te("",!0)])):te("",!0),de(e.$slots,"tableTitle",{},void 0,!0)]),R("div",Yt,[de(e.$slots,"toolbar",{},void 0,!0),z(s,{trigger:"hover"},{trigger:I((()=>[R("div",{class:"table-toolbar-right-icon",onClick:t[0]||(t[0]=(...t)=>e.reload&&e.reload(...t))},[z(r,{size:"18"},{default:I((()=>[z(u)])),_:1})])])),default:I((()=>[Jt])),_:1}),z(s,{trigger:"hover"},{trigger:I((()=>[R("div",Zt,[z(d,{onSelect:e.densitySelect,trigger:"click",options:e.densityOptions,value:e.tableSize,"onUpdate:value":t[1]||(t[1]=t=>e.tableSize=t)},{default:I((()=>[z(r,{size:"18"},{default:I((()=>[z(c)])),_:1})])),_:1},8,["onSelect","options","value"])])])),default:I((()=>[en])),_:1}),z(p)])]),R("div",tn,[z(g,ne({ref:"tableElRef"},e.getBindValues,{pagination:e.pagination,"onUpdate:page":e.updatePage,"onUpdate:pageSize":e.updatePageSize}),me({_:2},[pe(Object.keys(e.$slots),(t=>({name:t,fn:I((n=>[de(e.$slots,t,ge(fe(n)),void 0,!0)]))})))]),1040,["pagination","onUpdate:page","onUpdate:pageSize"])])],64)}],["__scopeId","data-v-1b1df032"]]);const on=g({name:"TableAction",components:{DownOutlined:ye},props:{actions:{type:Array,default:null,required:!0},dropDownActions:{type:Array,default:null},style:{type:String,default:"button"},select:{type:Function,default:()=>{}}},setup(e){const{hasPermission:t}=Le(),n="button"===e.style?"default":"text"===e.style?"primary":"default",o="button"===e.style?void 0:"text"===e.style||void 0,l=w((()=>({text:o,type:n,size:"small"}))),i=w((()=>(E(e.dropDownActions)||[]).filter((e=>t(e.auth)&&a(e))).map((e=>{const{popConfirm:t}=e;return s(r(r({size:"small",text:o,type:n},e),t),{onConfirm:null==t?void 0:t.confirm,onCancel:null==t?void 0:t.cancel})}))));function a(e){const t=e.ifShow;let n=!0;return _e(t)&&(n=t),Pe(t)&&(n=t(e)),n}return{getActions:w((()=>(E(e.actions)||[]).filter((e=>t(e.auth)&&a(e))).map((e=>{const{popConfirm:t}=e;return s(r(r({size:"small",text:o,type:n},e),t||{}),{onConfirm:null==t?void 0:t.confirm,onCancel:null==t?void 0:t.cancel,enable:!!t})})))),getDropdownList:i,getMoreProps:l}}}),ln={class:"tableAction"},an={class:"flex items-center justify-center"},rn={class:"flex items-center"},sn=R("span",null,"更多",-1);var un=xe(on,[["render",function(e,t,n,o,l,i){const a=m("n-button"),r=m("DownOutlined"),s=m("n-icon"),u=m("n-dropdown");return L(),Y("div",ln,[R("div",an,[(L(!0),Y(he,null,pe(e.getActions,((e,t)=>(L(),D(a,ne({key:`${t}-${e.label}`},e,{class:"mx-2"}),{default:I((()=>[N(ee(e.label),1)])),_:2},1040)))),128)),e.dropDownActions&&e.getDropdownList.length?(L(),D(u,{key:0,trigger:"hover",options:e.getDropdownList,onSelect:e.select},{default:I((()=>[de(e.$slots,"more"),e.$slots.more?te("",!0):(L(),D(a,ne({key:0},e.getMoreProps,{class:"mx-2","icon-placement":"right"}),{default:I((()=>[R("div",rn,[sn,z(s,{size:"14",class:"ml-1"},{default:I((()=>[z(r)])),_:1})])])),_:1},16))])),_:3},8,["options","onSelect"])):te("",!0)])])}]]);export{nn as B,un as T};
