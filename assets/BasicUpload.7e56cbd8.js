var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,o)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,__spreadValues=(e,t)=>{for(var o in t||(t={}))__hasOwnProp.call(t,o)&&__defNormalProp(e,o,t[o]);if(__getOwnPropSymbols)for(var o of __getOwnPropSymbols(t))__propIsEnum.call(t,o)&&__defNormalProp(e,o,t[o]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t));import{b4 as NUpload,d as defineComponent,bM as EyeOutlined,bN as DeleteOutlined,bO as PlusOutlined,j as computed,a3 as useMessage,a4 as useDialog,i as reactive,h as toRefs,X as resolveComponent,o as openBlock,c as createElementBlock,a as createBaseVNode,F as Fragment,r as renderList,bK as normalizeStyle,Y as createVNode,Z as withCtx,bz as mergeProps,$ as createCommentVNode,a0 as createBlock,bj as createTextVNode,t as toDisplayString}from"./vendor.70faab48.js";import{n as useGlobSetting,_ as _export_sfc,c as isString,R as ResultEnum}from"./index.2cc56d29.js";import{c as componentSetting}from"./componentSetting.df76d574.js";const basicProps=__spreadProps(__spreadValues({},NUpload.props),{accept:{type:String,default:".jpg,.png,.jpeg,.svg,.gif"},helpText:{type:String,default:""},maxSize:{type:Number,default:2},maxNumber:{type:Number,default:Infinity},value:{type:Array,default:()=>[]},width:{type:Number,default:104},height:{type:Number,default:104}});var BasicUpload_vue_vue_type_style_index_0_lang=".upload {\n  width: 100%;\n  overflow: hidden;\n}\n.upload-card {\n  width: auto;\n  height: auto;\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n}\n.upload-card-item {\n  margin: 0 8px 8px 0;\n  position: relative;\n  padding: 8px;\n  border: 1px solid #d9d9d9;\n  border-radius: 2px;\n  display: flex;\n  justify-content: center;\n  flex-direction: column;\n  align-items: center;\n}\n.upload-card-item:hover {\n  background: 0 0;\n}\n.upload-card-item:hover .upload-card-item-info::before {\n  opacity: 1;\n}\n.upload-card-item:hover-info::before {\n  opacity: 1;\n}\n.upload-card-item-info {\n  position: relative;\n  height: 100%;\n  padding: 0;\n  overflow: hidden;\n}\n.upload-card-item-info:hover .img-box-actions {\n  opacity: 1;\n}\n.upload-card-item-info::before {\n  position: absolute;\n  z-index: 1;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  opacity: 0;\n  transition: all 0.3s;\n  content: ' ';\n}\n.upload-card-item-info .img-box {\n  position: relative;\n  border-radius: 2px;\n}\n.upload-card-item-info .img-box-actions {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 10;\n  white-space: nowrap;\n  transform: translate(-50%, -50%);\n  opacity: 0;\n  transition: all 0.3s;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.upload-card-item-info .img-box-actions:hover {\n  background: 0 0;\n}\n.upload-card-item-info .img-box-actions .action-icon {\n  color: rgba(255, 255, 255, 0.85);\n}\n.upload-card-item-info .img-box-actions .action-icon:hover {\n  cursor: pointer;\n  color: #fff;\n}\n.upload-card-item-select-picture {\n  border: 1px dashed #d9d9d9;\n  border-radius: 2px;\n  cursor: pointer;\n  background: #fafafa;\n  color: #666;\n}\n.upload-card-item-select-picture .upload-title {\n  color: #666;\n}\n";const globSetting=useGlobSetting(),_sfc_main=defineComponent({name:"BasicUpload",components:{EyeOutlined:EyeOutlined,DeleteOutlined:DeleteOutlined,PlusOutlined:PlusOutlined},props:__spreadValues({},basicProps),emits:["uploadChange","delete"],setup(props,{emit:emit}){const getCSSProperties=computed((()=>({width:`${props.width}px`,height:`${props.height}px`}))),message=useMessage(),dialog=useDialog(),state=reactive({showModal:!1,previewUrl:"",originalImgList:[],imgList:[]});function preview(e){state.showModal=!0,state.previewUrl=e}function remove(e){dialog.info({title:"提示",content:"你确定要删除吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{state.imgList.splice(e,1),state.originalImgList.splice(e,1),emit("uploadChange",state.originalImgList),emit("delete",state.originalImgList)},onNegativeClick:()=>{}})}function getImgUrl(e){const{imgUrl:t}=globSetting;return/(^http|https:\/\/)/g.test(e)?e:`${t}${e}`}function checkFileType(e){return componentSetting.upload.fileType.includes(e)}function beforeUpload({file:e}){const t=e.file,{maxSize:o,accept:n}=props,i=isString(n)&&n.split(",")||[];if(o&&t.size/1024/1024>=o)return message.error(`上传文件最大值不能超过${o}M`),!1;const a=componentSetting.upload.fileType;return!(i.length>0&&!checkFileType(t.type))||(message.error(`只能上传文件类型为${a.join(",")}`),!1)}function finish({event:Event}){const res=eval("("+Event.target.response+")"),infoField=componentSetting.upload.apiSetting.infoField,{code:code}=res,message=res.msg||res.message||"上传失败",result=res[infoField];if(code===ResultEnum.SUCCESS){let e=getImgUrl(result.photo);state.imgList.push(e),state.originalImgList.push(result.photo),emit("uploadChange",state.originalImgList)}else message.error(message)}return props.value.length&&(state.imgList=props.value.map((e=>getImgUrl(e)))),__spreadProps(__spreadValues({},toRefs(state)),{finish:finish,preview:preview,remove:remove,beforeUpload:beforeUpload,getCSSProperties:getCSSProperties})}}),_hoisted_1={class:"w-full"},_hoisted_2={class:"upload"},_hoisted_3={class:"upload-card"},_hoisted_4={class:"upload-card-item-info"},_hoisted_5={class:"img-box"},_hoisted_6=["src"],_hoisted_7={class:"img-box-actions"},_hoisted_8={class:"flex justify-center flex-col"},_hoisted_9=createBaseVNode("span",{class:"upload-title"},"上传图片",-1),_hoisted_10=["src"];function _sfc_render(e,t,o,n,i,a){const s=resolveComponent("EyeOutlined"),r=resolveComponent("n-icon"),l=resolveComponent("DeleteOutlined"),d=resolveComponent("PlusOutlined"),p=resolveComponent("n-upload"),c=resolveComponent("n-alert"),m=resolveComponent("n-space"),u=resolveComponent("n-modal");return openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.imgList,((t,o)=>(openBlock(),createElementBlock("div",{class:"upload-card-item",style:normalizeStyle(e.getCSSProperties),key:`img_${o}`},[createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,[createBaseVNode("img",{src:t},null,8,_hoisted_6)]),createBaseVNode("div",_hoisted_7,[createVNode(r,{size:"18",class:"action-icon mx-2",onClick:o=>e.preview(t)},{default:withCtx((()=>[createVNode(s)])),_:2},1032,["onClick"]),createVNode(r,{size:"18",class:"action-icon mx-2",onClick:t=>e.remove(o)},{default:withCtx((()=>[createVNode(l)])),_:2},1032,["onClick"])])])],4)))),128)),e.imgList.length<e.maxNumber?(openBlock(),createElementBlock("div",{key:0,class:"upload-card-item upload-card-item-select-picture",style:normalizeStyle(e.getCSSProperties)},[createVNode(p,mergeProps(e.$props,{"file-list-style":{display:"none"},onBeforeUpload:e.beforeUpload,onFinish:e.finish}),{default:withCtx((()=>[createBaseVNode("div",_hoisted_8,[createVNode(r,{size:"18",class:"m-auto"},{default:withCtx((()=>[createVNode(d)])),_:1}),_hoisted_9])])),_:1},16,["onBeforeUpload","onFinish"])],4)):createCommentVNode("",!0)])]),createVNode(m,null,{default:withCtx((()=>[e.helpText?(openBlock(),createBlock(c,{key:0,title:"提示",type:"info",class:"flex w-full"},{default:withCtx((()=>[createTextVNode(toDisplayString(e.helpText),1)])),_:1})):createCommentVNode("",!0)])),_:1})]),createVNode(u,{show:e.showModal,"onUpdate:show":t[0]||(t[0]=t=>e.showModal=t),preset:"card",title:"预览",bordered:!1,style:{width:"520px"}},{default:withCtx((()=>[createBaseVNode("img",{src:e.previewUrl},null,8,_hoisted_10)])),_:1},8,["show"])],64)}var BasicUpload=_export_sfc(_sfc_main,[["render",_sfc_render]]);export{BasicUpload as B};
